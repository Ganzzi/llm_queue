# Version 0.2.0 Development Progress

## Overview
Version 0.2.0 is a major update with breaking changes to improve API design and type safety. This document tracks the progress of the migration.

## Breaking Changes Summary

### Dual-Generic Type System

**Before (v0.1.0):**
```python
QueueRequest[T]     # T = result type
  result: Optional[T]

QueueResponse[T]
  result: Optional[T]

Queue[T]
QueueManager[T]
processor_func: Callable[[QueueRequest[T]], Awaitable[T]]
```

**After (v0.2.0):**
```python
QueueRequest[P]     # P = parameters type
  params: P
  wait_for_completion: bool = True

QueueResponse[T]    # T = result type
  result: Optional[T]

Queue[P, T]
QueueManager[P, T]
processor_func: Callable[[QueueRequest[P]], Awaitable[T]]
```

### New Features
- **Dual generics**: Separate types for request params and response results
- **wait_for_completion**: Fire-and-forget requests that return immediately with PENDING status
- **Type safety**: Full Pydantic model support for params and results

---

## Progress Tracker

### ‚úÖ Completed

#### Planning & Design
- ‚úÖ Updated `docs/plan/project_plan.md` with v0.2.0 roadmap
- ‚úÖ Removed "Future Enhancements" section
- ‚úÖ Created detailed v0.2.0 checklist in plan
- ‚úÖ Documented breaking changes and migration path

#### Core Code Changes
- ‚úÖ **models.py**: 
  - Added `P` TypeVar for parameters
  - Changed `QueueRequest[T]` to `QueueRequest[P]`
  - Removed `result` field from `QueueRequest`
  - Added `params: P` field to `QueueRequest`
  - Added `wait_for_completion: bool` field
  - Updated docstrings

- ‚úÖ **queue.py**:
  - Changed to `Queue[P, T]` with dual generics
  - Updated processor_func signature to `Callable[[QueueRequest[P]], Awaitable[T]]`
  - Implemented `wait_for_completion` logic in `enqueue()`
  - Returns immediately with PENDING status when `wait_for_completion=False`
  - Removed `request.result` assignments (moved result to response only)
  - Updated all type hints

- ‚úÖ **manager.py**:
  - Changed to `QueueManager[P, T]` with dual generics
  - Updated all method signatures
  - Updated processor_func signature in `register_queue()`
  - Updated docstrings

#### Examples
- ‚úÖ **typed_models_example.py** (NEW):
  - Demonstrates `LLMParams` Pydantic model for parameters
  - Demonstrates `LLMResult` Pydantic model for results
  - Shows full type safety with IDE support
  - Includes `wait_for_completion=False` example
  - Shows validation error handling

### üîÑ In Progress

None currently - ready to continue with tests and documentation updates.

### ‚è≥ TODO

#### Update Existing Examples
- [ ] **basic_usage.py**: Update to use `params` field
- [ ] **openai_example.py**: Create proper params/result models
- [ ] **concurrent_mode.py**: Update to use new API
- [ ] **advanced_usage.py**: Add `wait_for_completion=False` demo
- [ ] **examples/README.md**: Document new patterns

#### Update Tests
- [ ] **test_models.py**: 
  - Test `QueueRequest[P]` with params
  - Test `wait_for_completion` field
  - Test Pydantic model validation

- [ ] **test_queue.py**:
  - Update for `Queue[P, T]` dual generics
  - Test `wait_for_completion=True` (default behavior)
  - Test `wait_for_completion=False` (immediate return)
  - Verify PENDING status on immediate return

- [ ] **test_manager.py**:
  - Update for `QueueManager[P, T]` dual generics
  - Test with custom Pydantic models

- [ ] **test_init.py**:
  - Verify exports work with new types
  - Integration tests with new API

- [ ] Run full test suite and ensure 90%+ coverage maintained

#### Update Documentation
- [ ] **README.md**:
  - Update Quick Start with `params` field
  - Show Pydantic model example
  - Document `wait_for_completion`
  - Update all code examples

- [ ] **docs/guides/getting_started.md**:
  - Complete rewrite for new API
  - Add migration guide section

- [ ] **docs/QUICK_REFERENCE.md**:
  - Update all signatures
  - Add dual-generic examples

- [ ] **Create MIGRATION.md**:
  - Before/after examples
  - Step-by-step migration guide
  - Common pitfalls

#### Version & Release
- [ ] Update `src/llm_queue/__version__.py` to "0.2.0"
- [ ] Update `pyproject.toml` version
- [ ] Update `setup.py` version
- [ ] Update `CHANGELOG.md` with breaking changes
- [ ] Final validation: run all examples, tests, docs
- [ ] Git tag and GitHub release
- [ ] PyPI publish

---

## Migration Guide (Draft)

### For Users Migrating from v0.1.0 to v0.2.0

#### Step 1: Update Request Creation

**Before:**
```python
request = QueueRequest(
    model_id="gpt-4",
    metadata={"prompt": "Hello", "max_tokens": 100}
)
```

**After:**
```python
# Option 1: Simple dict params
request = QueueRequest(
    model_id="gpt-4",
    params={"prompt": "Hello", "max_tokens": 100}
)

# Option 2: Typed Pydantic model (recommended)
class LLMParams(BaseModel):
    prompt: str
    max_tokens: int = 100

params = LLMParams(prompt="Hello")
request = QueueRequest(model_id="gpt-4", params=params)
```

#### Step 2: Update Processor Function

**Before:**
```python
async def processor(request: QueueRequest) -> dict:
    prompt = request.metadata["prompt"]
    # Process...
    return {"response": "..."}
```

**After:**
```python
# With dict params
async def processor(request: QueueRequest[dict]) -> dict:
    prompt = request.params["prompt"]
    # Process...
    return {"response": "..."}

# With typed params (recommended)
async def processor(request: QueueRequest[LLMParams]) -> LLMResult:
    prompt = request.params.prompt  # Type-safe!
    # Process...
    return LLMResult(response="...")
```

#### Step 3: Update Type Hints

**Before:**
```python
manager: QueueManager[dict] = QueueManager()
```

**After:**
```python
# Specify both param and result types
manager: QueueManager[dict, dict] = QueueManager()

# Or with typed models
manager: QueueManager[LLMParams, LLMResult] = QueueManager()
```

#### Step 4: Use New Features

```python
# Fire-and-forget request (returns immediately)
request = QueueRequest(
    model_id="gpt-4",
    params=params,
    wait_for_completion=False  # NEW!
)

response = await manager.submit_request(request)
# response.status == "pending"

# Poll for status later (optional)
status = await manager.get_status("gpt-4", response.request_id)
```

---

## Testing Plan

1. **Unit Tests**: Update all unit tests for new API
2. **Integration Tests**: Ensure end-to-end workflows work
3. **Type Checking**: Run `mypy` to verify type safety
4. **Coverage**: Maintain 90%+ test coverage
5. **Examples**: Run all examples to verify functionality
6. **Performance**: Ensure no performance regression

---

## Timeline

- **Day 1**: ‚úÖ Core code changes (models, queue, manager)
- **Day 2**: ‚è≥ Update examples and create new typed example
- **Day 3**: ‚è≥ Update all tests and run test suite
- **Day 4**: ‚è≥ Update documentation (README, guides, references)
- **Day 5**: ‚è≥ Final validation, version bump, release

---

## Notes

- This is a **breaking change** release
- Version number jumps from 0.1.0 to 0.2.0 (minor version bump per semver)
- After 0.2.0, the API will be stable and ready for 1.0.0
- All breaking changes are documented and migration path is clear
- Full type safety with Pydantic models is the recommended approach
